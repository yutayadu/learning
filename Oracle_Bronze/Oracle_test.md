# ---カテゴリ整理---

## ---Oacle Database の構成---

### ファイル/ディレクトリ
- 初期化パラメータファイル
    - 初期化パラメータ
        - 「DB_NAME（静）」「MEMORY_TARGET（動）」「PROCESSES（静）」<br>「DB_BLOCK_SIZE（静）」「CONTROL_FILES（静）」
        - 「SGA_TARGET」
    - SPFILEとPFILE
- ★制御ファイル
    - データベースの物理構造が記録されている
    - バイナリ形式のファイルである
    - 制御ファイル名は初期化パラメータ「CONTROL_FILES」に記録されている
- ★データファイル
    - データファイルは、データベースに作成された表や索引などのデータベース・オブジェクトのデータが格納された、OSから物理的に認識できるファイルです。
    - Oracle Databaseを起動するには最低1つのデータファイルが必要です。
- REDO
    - ★REDOログ・ファイル
        - REDOログ・グループを2つ以上のメンバーで構成し多重化していれば、あるメンバーが壊れてもインスタンスを停止することなく運用を続けることができる
        - LGWRが現在書き込みを行なっているファイルをカレント(CURRENT)のREDOログ・ファイルと呼び、カレントのREDOログ・ファイルから別のREDOログ・ファイルへ書き込み先を切り替えることを「ログ・スイッチ」
    - REDOログ・バッファ
        - データの変更履歴であるREDOエントリが格納される領域。
        - データの追加や更新時に、サーバー・プロセスによって、REDOエントリがREDOログ・バッファに書き込まれます
- UNDO
    - 必要なUNDOデータが失われると「ORA-1555: Snapshot too old」エラーが発生
        - 保存保証を有効 / UNDO保存期間（UNDO_RETENTION）を長く / UNDO表領域サイズを大きく
    - 自動UNDO管理
    - UNDOデータ
        - トランザクションのロールバック
        - 読取り一貫性
        - フラッシュバック機能
    - UNDO表領域
        - UNDO表領域はロールバックに使用されるUNDOデータ(データの更新前の値)を格納する
        - UNDOデータ専用のため、ユーザーが作成した表や索引などのデータベース・オブジェクトは格納できない
        - UNDO表領域は複数作成可だが、有効にできるUNDO表領域は1つだけ
        - デフォルトで自動UNDO管理が有効になっており、Oracle Databaseにより自動管理
- listener.ora
    - リスナー名
    - プロトコル
    - ホスト名
    - ポート番号
        ```bash
        LISTENER =
          (DESCRIPTION =
            (ADDRESS = (PROTOCOL = TCP)(HOST = localhost.localdomain)(PORT = 1521))
          )
        ADR_BASE_LISTENER = /u01/app/oracle
        ```
- tnsname.ora
    - ローカル・ネーミングでは、接続識別子(ネット・サービス名、またはネットワーク・サービス名)と接続記述子をクライアントマシンの「tnsnames.ora」ファイルに格納して名前解決
    - ローカル・ネーミングの構成を行えるツールには、次のものがあります。
        - Net Manager
        - Net Configuration Assistant
        - Enterprise Manager Cloud Control
- sqlnet.ora
    - クライアントとサーバに必要なネットワークファイルで（ローカルネーミング構成の場合はクライアント側には不要）、使用するネーミングメソッドの優先順やデフォルトのドメイン名を指定
        ```bash
        SQLNET.AUTHENTICATION_SERVICES = (NTS)
        NAMES.DIRECTORY_PATH = (TNSNAMES, HOSTNAME)
        NAMES.DEFAULT_DOMAIN = winsrv
        ```
- pga
    - プログラム・グローバル領域(PGA)は、サーバー・プロセスやバックグラウンド・プロセスに割り当てられる、プロセスに固有のメモリー領域
        - プライベートSQL領域：SQL実行時に使用するセッション固有の情報、SQLの中で使用される変数(バインド変数)
        - SQL作業領域：SQL実行時に使用するソート・データやハッシュ表
        - セッション・メモリー：セッションのログイン情報
### インストール
- ORACLE_BASE
    - Oracleソフトウェアのディレクトリ構造の基本となるディレクトリ(異なるverでも共有)
- ORACLE_HOME
    - 同マシンに異なるOracle Databaseをインストールする際、異なるHOMEを設定
- OSグループ
    - oinstall(ソフト) / dba(管理全部) / oper(管理一部)
- インベントリ・ディレクトリ
    - Oracleソフトウェアやパッチのメタデータの格納場所
        - 初めてインストールする時に作成 / すべてのOracleソフトウェアで共有
- データベース・テンプレート
    - XML形式のファイルである
    - Oracle社からテンプレートが提供されている
    - 既存のデータベースを基にしてテンプレートを作成できる
### 概念
- リレーショナル・データベース
    - 構造 - オブジェクトとリレーション
    - 操作 - 一連の演算子
    - 整合性規則
- 表
    - 1行で1件のデータ / 1つのフィールドには1つの値
    - 主キーとなる列には必ず値を格納する
    - 外部キーとなる列にNULL値を格納できる
- 表領域
    - アラート
        - デフォルトで「警告」と「クリティカル」の2つのアラートしきい値が定義されています。
            - 警告: 領域が残り少なくなり始める境界値
            - クリティカル: 至急対処が必要な深刻な境界値
    - 削除
        - データベース・オブジェクトのデータ
        - データディクショナリに格納されているオブジェクトの定義
        - データファイルの削除（*DROP TABLESPACE*文「*INCLUDING CONTENTS AND DATAFILES*」句）
    - SYSTEM表領域（削除できない）
    - bigfile表領域
        - **bigfile表領域(1つだけデータファイルを割り当てられる)の場合**
            - **ALTER TABLESPACE文でも表領域のサイズを変更できる**
                ```sql
                ALTER TABLESPACE 表領域名 RESIZE サイズ;
                ```
    - smallfile表領域
        - 直接表領域をRESIZEできない
        - 拡張
            - ALTER DATABASE文で、既存のデータファイルのサイズを大きくする
                ```sql
                ALTER DATABASE DATAFILE 'データファイル名' RESIZE サイズ;
                ```
            - ALTER TABLESPACE文で、新しいデータファイルを追加する
                ```sql
                ALTER TABLESPACE 表領域名 ADD DATAFILE 'データファイル名' SIZE サイズ;
                ```
            - ALTER DATABASE文で、既存のデータファイルの自動拡張を有効にする
                ```sql
                ALTER DATABASE DATAFILE 'データファイル名'
                　　AUTOEXTEND ON NEXT 増分 MAXSIZE {UNLIMITED | 上限サイズ};
                ```
- スキーマオブジェクト
    - ユーザーの持つデータベースオブジェクト（表、索引、ビュー、シノニム、順序）
    - プログラム・コード
        - パッケージ
        - プロシージャ
        - トリガー
        - JavaソースとJavaクラス
        - ファンクション
- セグメント
    - 手動セグメント領域管理
        - セグメント内の空き領域を、空きリストを使用して管理する
        - OFF : 自動セグメント領域管理 : ビットマップを使用してセグメント内空き領域を管理
- データ・ディクショナリ (データ定義書みたいな・・・)
    - データベースに関する様々な管理情報が格納された読取り専用の表
        - データベース・オブジェクトやユーザーの定義情報など
    - データベースを使用するために必要となる複数の実表、およびビューのセット
    - SYSTEM表領域に自動的に作成され、データベースに1つだけ存在する
- データ・ディクショナリ・ビュー
    - データディクショナリの実表をユーザーに使わせるわけにはいかないので、ビューを提示する
    - 「SELECT_CATALOG_ROLE」で、ユーザーに、ビューのSELECT権限を付与する
- ビュー
    - ビューとは複数のテーブルに対する検索・集計・結合処理をテーブルみたいに表現する仕組みです。
    - 使用頻度の高い結合処理や、複雑な検索処理に対してビューを作成することで、
    - 何度も同じ問い合わせを書く必要がなくなります。
- マテリアイズド・ビュー
    - マテビューとは、ビューと同様に問い合わせ結果をテーブルとして表現し、必要に応じて最新の状態に更新することができる仕組みです。“スナップショット”という言葉がしっくりくるかと思います。
    - マテビューの実体はテーブルです。そのため、複雑な検索・集計処理でも高速に結果を得ることができます。
### データベース内のプロセス関連
- チェックポイント
    - チェックポイント・イベントは、ログ・スイッチ発生時や一貫性のあるインスタンス停止時(SHUTDOWN ABORT以外の停止モードで正常に停止する)に発生する
    - チェックポイント・イベントの発生時にDBWnに書き込みの指示を出す
    - チェックポイント・イベントの発生時に制御ファイルにチェックポイント情報を書き込む

## ---メモリ構造とプロセスの仕組み---
- 共有プール
    - SQLをキャッシュしておく領域
- データベース・バッファ・キャッシュ
    - データベースに格納されているデータに対し処理を行う際に使用されるデータ用の作業領域
    - DBWn(データベース・ライター)プロセスがデータファイルへ書き込むタイミング
        - チェックポイント・イベントの発生時
        - データベース・バッファキャッシュ内の再利用可能バッファが見つからない時
- サーバープロセス
    - ユーザー・プロセスからの接続要求を受信したリスナー・プロセスによってサーバー上に生成
    - サーバー・プロセスはユーザー・プロセスから受け取ったSQLを解析し、実行計画を作成して、SQLを実行します。SQLの実行後は、結果をユーザー・プロセスへ返します。
    - SQLの実行時に、データファイルからデータベース・バッファ・キャッシュへデータ・ブロックをコピーしたり、データの変更履歴であるREDOエントリをREDOログ・バッファへ書き込むのもサーバー・プロセスの役割です。
- メモリー管理
    - 自動メモリー管理(AMM)
    - 初期化パラメータ --- **別紙**
    - アドバイザ --- **別紙** 

## ---データベースオブジェクトの仕組み---
- 索引
    - 表に関連付けられ、データの問合せのパフォーマンスを向上させるスキーマ・オブジェクト
        - 1つの列、もしくは複数の列の組合せに対して作成できる
        - 1つの表に列が異なる複数の索引を作成できる
        - 主キー制約または一意キー制約が定義されている列には自動的に索引が作成される
        - DML文によってデータが挿入、更新、削除されると、索引は自動的にメンテナンスされる
        - Oracle Databaseが索引を使用するかどうかを判断する(INDEX/NO_INDEXなどヒント句の指定が無い場合)
        - 表と異なる表領域に作成できる

## ---権限管理---
- オブジェクト権限
    - 特定のデータベース・オブジェクトへの操作を許可するための権限
        - オブジェクトの種類(表・ビュー)によって付与できる権限が異なる
        - 付与された権限(SELECT/DELETE etc)を他のユーザーに付与できる
        - オブジェクトの所有者はオブジェクト権限が付与されていなくてもオブジェクトを参照できる
- システム権限
- ロール
    - 「CONNECT」「RESOURCE」「DBA」「SELECT_CATALOG_ROLE」
    - 「CREATE ANY TABLE」：他ユーザーのスキーマに表を作成可能（参照・更新は不可）
    - 「CREATE SESSION」「CREATE TABLE」「SELECT」

## ---SQLやトランザクション---
- データ制御言語
    - DML　：Data Manipulation Language ( SIn UP DM )
    - DDL　：Data Definition Language ( TRAC DROP )
    - DCL　：Data Control Language ( レーザーラモン RG )
    - トランザクション制御 ( CR Savepoint )
        | 分類  | コマンド  | 説明 |
        | ---   | ---       | --- |
        | データ検索（DML） | SELECT | 表に格納された行の参照(問い合わせ、検索) |
        | データ操作言語  | INSERT | 表への行の追加(挿入) |
        |       | UPDATE | 表に格納された行の更新 |
        |       | DELETE | 表に格納された行の削除 |
        |       | MERGE | データのマージ |
        | |
        | データ定義言語 (DDL) | CREATE | オブジェクトの作成 |
        |       | DROP | オブジェクトの削除 |
        |       | ALTER | オブジェクトの定義変更 |
        |       | TRUNCATE | 表に格納されたすべての行を一括削除(切り捨て) |
        |       | RENAME | オブジェクト名の変更 |
        | |
        | データ制御言語(DCL) | GRANT | 権限の付与 |
        |       | REVOKE | 権限の取り消し(剥奪) |
        | |
        | トランザクション制御 | COMMIT | トランザクションの確定 |
        |       | ROLLBACK | トランザクションの取り消し |
        |       | SAVEPOINT | セーブポイントの作成|    
- トランザクション
    - 原子性（全ての処理が成功でコミット/銀行の振込の話）
- SQLプロファイルというのは、SQLに対する補足情報みたいなものです。
    - 例えば、昨日の夜間バッチ処理で実行されたSQLに対して、もっと違う結合の順序の実行計画にすれば性能が上がる可能性がある、とかそんな情報があります。
## ---障害対応およびバックアップ---
- アラート・ログ
    - Oracle Databaseでの管理作業やエラーの情報が記録されるXML形式のログ・ファイル
        - 発生したすべての内部エラー(ORA-00600)、ブロック破損エラー(ORA-01578)、デッドロック・エラー(ORA-00060)
        - CREATE/ALTER/DROP文(DDL)、STARTUP/SHUTDOWN文、ARCHIVELOG文などの管理操作
        - インスタンスの起動時点でデフォルト値から変更のあった初期化パラメータの値
        - $ORACLE_BASE/diag/rdbms/<データベース名>/<SID>/alert
- 障害
    - インスタンス障害
        - REDOログ・ファイルの更新履歴をデータファイルに適用します(ロールフォワード)。この時、UNDOセグメントのUNDOデータも復元されます。
        - ロールフォワード後のデータファイルにはまだコミットされていないデータも含まれているため、UNDOデータを使用してコミットしていないデータをロールバック。
        - データファイルとREDOログ・ファイルの同期が取れた状態
    - インスタンス・リカバリ
        - SMONにより、次回起動時にインスタンス・リカバリを実行する
    - メディア・リカバリ (どちらにしろARCHIVELOGモード・モード切替はMOUNT時)
        - 完全リカバリ
            - 障害が発生した直前の状態に戻すリカバリ方法
            - 直近のバックアップファイルをリストア / 全てのアーカイブREDOログ・ファイルとREDOログ・ファイルの変更履歴を適用
        - 不完全リカバリ
            - 過去の任意の時点を指定し、その時点までのバックアップ・ファイルと変更履歴を適用
    - リカバリ
        - NOARCHIVELOGモード
    - フラッシュバック・ドロップ
        - 誤って削除した表を元に戻す機能
        - 表に定義されている索引、制約(他の表を参照する参照整合性制約を除く)、トリガーも元に戻る
        - 初期化パラメータ「RECYCLEBIN」を「on」
    - 一貫性バックアップ
        - データベースをクローズした状態でバックアップを取得
        - ARCHIVELOGモード/NOARCHIVELOGモードどちらの運用時でも取得できる<br>(NOARCHIVELOGモードで運用時は一貫性バックアップしか取得できない)
        - REDOログ・ファイルのコミット済みの変更がデータファイルに適用されている
        - 一貫性バックアップのファイルをリストアすると、メディア・リカバリをしなくてもデータベースをオープンできる(バックアップ取得時点まで復旧)
    - 非一貫性バックアップ
        - データベースをオープンした状態でバックアップを取得
        - ARCHIVELOGモードで運用時のみ取得可能
        - データファイルに書き込まれていないコミット済みの変更がREDOログ・ファイルに含まれる
        - 非一貫性バックアップのファイルをリストアしてデータベースをオープンするには、メディア・リカバリが必要である
        - Recovery Manager(RMAN)かOSのコマンド(cp、tarコマンドなど)で取得できますが、非一貫性バックアップをOSのコマンドで取得する場合は、SQLのALTER文でデータベース全体か表領域をバックアップモードに変更してから行う必要がある
    - AWR(Automatic Workload Repository: 自動ワークロード・リポジトリ)
        - スナップショット
            - デフォルトでは60分ごとに収集され、8日間保存
        - MMONプロセスがデータベースの稼働状況とパフォーマンスの統計情報を定期的に収集
        - SYSAUX表領域内の領域に格納
        - 
## ---ツール---
- ADDM
    - スナップショットが収集されると自動的に起動して、最新と1つ前のスナップショットを比較して分析
- Enterprise Manager Database Express (EM Express)
    - Webブラウザから操作できる
    - 共有サーバー接続である
    - データベースの起動と停止 / バックアップとリカバリ はできない！
    - アドバイザ
        - ADDM / メモリー・アドバイザ / SQLチューニング・アドバイザ / UNDOアドバイザ
            - SQLチューニング・アドバイザ
            - SQLアクセス・アドバイザ
                - SQLのワークロード(処理量、負荷)を分析し、**索引**や**マテリアライズド・ビュー**(実体を持ったビューのこと)などの作成・削除やオブジェクトの**パーティション化**(細分化)といった、主にスキーマの変更に関する推奨事項
    - ポート確認方法
        - コマンドラインで「lsnrctl status リスナー名」を実行する
        - SQL文「SELECT dbms_xdb_config.gethttpsport() FROM dual;」を実行する
    - ポート設定方法
        - EXEC DBMS_XDB_CONFIG.setHTTPSPort(ポート番号)

- Database Configuration Assistant(DBAC)([*dbca*])
    - 構成オプション
        - メモリー、ブロックサイズ(シードのみ)、キャラクタセット、接続モード、サンプルスキーマ
    - 事前定義済みテンプレート
        - 「汎用またはトランザクション処理」「カスタム・データベース」「データ・ウェアハウス」
    - Oracle Managed Files(OMF)の使用
        - データベースを構成するOSファイルをOracle Databaseが管理する
        - データベース管理者はファイル名やサイズを指定する必要はない
    - システム構成を修正する「修正スクリプト」と呼ばれるシェル・スクリプトが生成
        - runfixup.sh
- Oracle Data Guard
    - プライマリDBの障害発生時にフェイルオーバーでスタンバイDBに切り替え
    - プライマリDBのREDOデータをスタンバイDBに適用してデータをコピーする
- Oracle Universal Installer(OUI)([*runInstaller*])
    - 対話形式 or レスポンスファイルでの非対話式（./runInstaller -responseFile FileName）
- SQL*Loader
    - 制御ファイル(*.ctl)：データファイルの格納場所やロード先の表に関する情報が記述されたテキスト形式のファイル
    - データファイルは、ロードするデータがカンマ区切りなどで記述されたテキスト形式のファイル
- sql*Plus
    - SQL*PlusはコマンドラインからSQLを実行する対話形式のツールです。Oracle Databaseをインストールすると自動的にインストールされます。
    - SQL*Plusでは、SQL文、PL/SQL、SQL*Plusコマンドを実行できます。SQL文ではデータの検索や追加などのデータ操作のほか、インスタンスの起動・停止、バックアップやリカバリなどの管理作業も行えます。
        ```sql
        ---バックアップ
        ALTER TABLESPACE name BEGIN BACKUP;
        ```
- Recovery Manager
    - ラージ・プール

## ---高度な構成---
- Oracle Real Application Clusters（RAC）
    - 1つのOracleデータベースに対して2つ以上のOracleインスタンスを構成
    - 異なるサーバー上のインスタンスから共有ストレージのデータベース・ファイルにアクセス
    - 構成
        - Oracle Automatic Storage Management (ASM)
            - 共有ストレージ用のクラスタファイルシステムとして機能するボリューム・マネージャ及びファイルシステム
            - ストライピング、ミラーリングの機能によってI/Oパフォーマンスと耐障害性が向上する
        - Oracle Clusterware
            - 複数のデータベースサーバーを一群にまとめてクラスタ


# コマンド
- lsnrctl status
    - リスナーの構成ファイル、リスナーのポート番号、リスナーの稼働時間やログ・ファイルの場所、サービス(初期化パラメータSERVICE_NAMES)など
    ```bash
    (DESCRIPTION=(ADDRESS=(PROTOCOL=TCP)(HOST=localhost.localdomain)(PORT=1521)))に接続中
    リスナーのステータス
    ------------------------
    別名                      LISTENER
    バージョン                TNSLSNR for Linux: Version 19.0.0.0.0 - Production
    開始日                    04-7月 -2023 18:26:03
    稼働時間                  1 日 20 時間 35 分 29 秒
    トレース・レベル          off
    セキュリティ              ON: Local OS Authentication
    SNMP                      OFF
    パラメータ・ファイル      /u01/app/oracle/product/19.0.0/dbhome_1/network/admin/listener.ora
    ログ・ファイル            /u01/app/oracle/diag/tnslsnr/localhost/listener/alert/log.xml
    リスニング・エンドポイントのサマリー...
      (DESCRIPTION=(ADDRESS=(PROTOCOL=tcp)(HOST=localhost)(PORT=1521)))
    サービスのサマリー...
    サービス"orcl"には、1件のインスタンスがあります。
      インスタンス"orcl"、状態READYには、このサービスに対する1件のハンドラがあります...
    サービス"orclXDB"には、1件のインスタンスがあります。
      インスタンス"orcl"、状態READYには、このサービスに対する1件のハンドラがあります...
    ```
- lsnrctl servoces
    - サービス・ハンドラ(専用サーバー・プロセスや共有サーバー接続で使用されるディスパッチャなど、リスナーからデータベースへの接続ポイントとして機能するプロセス)の詳細
    ```bash
    (DESCRIPTION=(ADDRESS=(PROTOCOL=TCP)(HOST=localhost.localdomain)(PORT=1521)))に接続中
    サービスのサマリー...
    サービス"orcl"には、1件のインスタンスがあります。
      インスタンス"orcl"、状態READYには、このサービスに対する1件のハンドラがあります...
        ハンドラ:
          "DEDICATED" 確立:0 拒否:0 状態:ready
             LOCAL SERVER
    サービス"orclXDB"には、1件のインスタンスがあります。
      インスタンス"orcl"、状態READYには、このサービスに対する1件のハンドラがあります...
        ハンドラ:
          "D000" 確立:0 拒否:0 現行:0 最大:1022 状態:ready
             DISPATCHER <machine: localhost.localdomain, pid: 16903>
             (ADDRESS=(PROTOCOL=tcp)(HOST=localhost)(PORT=36003))
    ```
# SQL実行
- OMF(Oracle Managed File)
    ```sql
    SQL> alter session set DB_CREATE_FILE_DEST='/u02/app/oracle/oradata';
        セッションが変更されました。
    SQL> create tablespace ts_omf1 datafile size 20M;
        表領域が作成されました。
    SQL> SELECT FILE_NAME, BYTES from dba_data_files;

    FILE_NAME                  
    BYTES
    ----------------------------------------------------------------
    /u02/app/oracle/oradata/C101/datafile/o1_mf_ts_omf1_gh10smqj_.dbf
    20971520
    ```
- 表領域の作成
    ```sql
    CREATE TABLESPACE [{BIGFILE | SMALLFILE}] [{PERMANENT | TEMPORARY | UNDO}] 表領域名
    　　DATAFILE 'データファイル名' SIZE 初期サイズ
    　　　　[AUTOEXTEND {OFF | ON} NEXT 増分 MAXSIZE {UNLIMITED | 上限サイズ}]
    　　[EXTENT MANAGEMENT LOCAL {AUTOALLOCATE | UNIFORM SIZE サイズ}]
    　　[SEGMENT SPACE MANAGEMENT {AUTO | MANUAL}];
    ```

# 表のあれこれ
>表の定義の変更を行う上での制約
- ALTER TABLE文で、既存の表に新規の列を追加したり、列名やデータ型、サイズを変更できる
- 表の定義を変更する際、格納するスキーマと表領域は変更できない
- 列の定義を変更する場合、既存のデータよりも小さいサイズへの変更と、互換性のないデータ型への変更は不可
>表の作成時に必須の項目
- 表名
- 列名
- 列のデータ型とサイズ
>表の作成時に任意の項目
- スキーマ
- 表領域
- 制約
>スキーマ・オブジェクト
- 表
- 索引
- ビュー
- シノニム
- 順序
>表の削除
- ごみ箱(RECYCLEBIN)と呼ばれるデータ・ディクショナリ表に、削除した表とそれに関連する索引などのオブジェクトの情報が格納され、オブジェクト名が変更される
>ユーザーの削除
- ユーザーを削除するには、そのユーザーが所有しているオブジェクトも全て削除しなければならないため、ユーザーのオブジェクトだけを残すことはできません。
- また、データベースに接続中のユーザーは削除できません
>オブジェクトの削除
- オブジェクトが削除されると、他のユーザーに付与したそのオブジェクトに対するオブジェクト権限も自動的に削除されます。
>表領域の削除
- 表領域を削除すると、表領域に格納されているデータベース・オブジェクトのデータは削除され、またデータ・ディクショナリに格納されているオブジェクトの定義も削除され、オブジェクトを使用できなくなります。
- 表領域に割当てられていたデータファイルは、表領域の削除時に残すか削除するかを選択できます。SQLのDROP TABLESPACE文を使用する場合は、「INCLUDING CONTENTS AND DATAFILES」句を指定しないと、データファイルは削除されません。
- なお、SYSTEM表領域は削除できません。
```sql
DROP USER ユーザー名 [CASCADE];
```
# データベースへの接続のあれこれ
>接続に必要な情報は何か
- 必要な情報
    - プロトコル、ホスト名、ポート番号、サービス名、（データベースのユーザ名とPASS）
>各起動状態でできること
- SHUTDOWN
- NOMOUNT
    - データベースの作成
    - 制御ファイルの再作成
- MOUNT
    - REDOログ・ファイルやデータファイルの名前変更
    - データベースのリカバリ
- OPEN
>遷移（open）
- [インスタンスの起動(SHUTDOWN → NOMOUNT)]
    - 1. サーバー・パラメータ・ファイルまたはテキスト初期化パラメータ・ファイルを読み込み、初期化パラメータの値を取得する
    - 2. 初期化パラメータの値に従って、システム・グローバル領域(SGA)を割当てる
    - 3. バックグラウンド・プロセスを起動する
    - 4. アラート・ログ・ファイルをオープンし、ログの出力を開始する
- [データベースのマウント(NOMOUNT → MOUNT)]
    - 5. 初期化パラメータ「CONTROL_FILES」で指定された格納場所から制御ファイルを読み込む
- [データベースのオープン(MOUNT → OPEN)]
    - 6. 制御ファイルで指定された格納場所にあるデータファイルとREDOログ・ファイルをオープンする
>遷移（シャットダウン）
- [データベースのクローズ(OPEN → CLOSE)]
    - 1. チェックポイントが発生し、SGA内のデータをデータファイルとREDOログ・ファイルに書き込む
    - 2. データファイルとREDOログ・ファイルをクローズする
- [データベースのアンマウント(CLOSE → NOMOUNT)]
    - 3. データベースをアンマウントしてインスタンスから切り離す
    - 4. 制御ファイルをクローズする
- [インスタンスの停止(NOMOUNT → SHUTDOWN)]
    - 5. SGAをメモリーから削除する
    - 6. バックグラウンド・プロセスを停止する
# バックグラウンドプロセスのあれこれ
>データベースファイルへの書込みまでの流れ
- ログスイッチ -> CKPT（イベント） -> DBWn
>LGWRプロセスがREDOログ・ファイルへ書き込みを行うタイミング
- システム・グローバル領域(SGA)のREDOログ・バッファに格納されているREDOエントリは、LGWRプロセスによりREDOログ・ファイルへ書き込まれます。LGWRプロセスがREDOログ・ファイルへ書き込みを行うタイミングは次のとおりです。
    - トランザクションがコミットされた時
    - ログ・スイッチが発生した時
    - 前回の書き込みから3秒経過した時
    - REDOログ・バッファが1/3になった時
    - REDOログ・バッファのREDOエントリの合計が1MB以上になった時
    - DBWnが使用済みバッファをデータファイルへ書き込む必要がある時
>SMONはいつ動くか
- 「インスタンス障害」とは、停電や「SHUTDOWN ABORT」コマンドでの強制終了により、Oracleインスタンスが突然停止してしまった場合に発生する障害のことです。
- インスタンス障害時のリカバリ処理は「インスタンス・リカバリ」と呼ばれ、インスタンス障害発生後、初めてデータベースをオープンした時にSMONプロセスによって自動的に実行されます。


# 苦手分野
>Database Configuration Assistantでデータベースを作成する際、設定可能な構成オプションはどれですか(3つ選択して下さい)。但し、データベース・テンプレートに「汎用またはトランザクション処理」を選択してデータベースを作成するものとします。
- メモリー管理
- キャラクタ・セット
- 接続モード(専用サーバー・モードまたは共有サーバー・モード)
    ```
    ・ブロック・サイズ
    設問で選択した「汎用またはトランザクション処理」は、データベースの構造と物理データファイルの両方が含まれているシード・テンプレートです。シード・テンプレートを使用した場合、物理データファイルは既に作成されているため、ファイルのブロック・サイズをデフォルトの8KBから変更できません。

    ・デフォルト表領域
    デフォルト表領域はユーザーの作成時に指定する項目です。
    ```
>索引に関する説明として、正しいものはどれですか(3つ選択してください)。
- 複数の列の組合せに対して作成できる
- 主キー制約または一意キー制約が定義された列には自動的に索引が作成される
- 表と異なる表領域に作成できる
```
・1つの列、もしくは複数の列の組合せに対して作成できる
・1つの表に列が異なる複数の索引を作成できる
・主キー制約または一意キー制約が定義されている列には自動的に索引が作成される
・DML文によってデータが挿入、更新、削除されると、索引は自動的にメンテナンスされる
・Oracle Databaseが索引を使用するかどうかを判断する(INDEX/NO_INDEXなどヒント句の指定が無い場合)
・表と異なる表領域に作成できる
```
>アーカイブ・モードの変更はデータベースがどの状態の時に行うか
- MOUNT
    ```sql
    CONNECT / AS SYSDBA
    SHUTDOWN IMMEDIATE
    STARTUP MOUNT

    ALTER DATABASE ARCHIVELOG;

    ALTER DATABASE OPEN;
    ```