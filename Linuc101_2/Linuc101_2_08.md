# 8章 システム管理
# 8.1 アカウント管理
## 8.1.1 ユーザの追加
- 主なユーザ管理コマンド  

| コマンド | 意味 |
| --- | --- |
| useradd | ユーザの追加 |
| usermod | ユーザの編集 |
| userdel | ユーザの削除 |
| groupadd | グループの追加 |
| groupmod | グループの編集 |
| groupdel | グループの削除 |
| passwd | パスワードの設定 |
| id | ユーザとグループのID情報を表示 |

### useradd
```bash
useradd [オプション] ユーザ名
```
- オプション
    | オプション | 説明 |
    | --- | --- |
    | -u UID | ユーザID(UID)を指定 |
    | -g グループ名/GID | 主グループを指定 |
    | -G グループ名/GID | 補助グループを指定 |
    | -c コメント | コメントを指定 |
    | -d ディレクトリ名 | ホームディレクトリを指定 |
    | -s パス | ログインシェルを指定 |
    | -m | ホームディレクトリを作成 |
    | -D | アカウントのデフォルト値えお表示または設定 |

### passwd
- ユーザ名を指定してパスワードを設定できるのはrootのみ
```bash
passwd [オプション] [ユーザ名]
```
### ホームディレクトリについて
- ユーザ追加時にホームディレクトリが生成される際に、**/etc/skel/**ディレクトリの内容を参照して中にあるファイルやサブディレクトリをコピーする
- Debian 環境では「-m」を指定しないとホームディレクトリが作成されない

## 8.1.2 グループとユーザの管理
- 主グループ（プライマリグループ）
    - ユーザは必ず一つの主グループに参加する必要がある
- 補助グループ（セカンダリグループ、サブグループ）
- ユーザ追加時にグループを追加しなければ、同名のグループが作成される
### id
```bash
# 指定したユーザのID情報を表示
id [オプション] ユーザ名
```

### groupadd
```bash
groupadd [オプション] グループ名

    -g GID ：   グループIDを指定
```
### usermod
```bash
# ユーザの設定を変更
usermod [オプション] ユーザ名
```
- 主なオプション
    | オプション | 説明 |
    | --- | --- |
    | -u UID | ユーザID(UID)を指定 |
    | -g グループ名/GID | 主グループを指定 |
    | -G グループ名/GID | 補助グループを指定 |
    | -c コメント | コメントを指定 |
    | -d ディレクトリ名 | ホームディレクトリを指定 |
    | -s パス | ログインシェルを指定 |
    | -l 新ユーザ名 | ユーザ名を指定（新ユーザ名に変更） |
    | -a | -Gを併用し、補助グループを追加 |
    
### groupmod
```bash
# グループの設定を変更
groupmod [オプション] グループ名
```
- 主なオプション
    | オプション | 説明 |
    | --- | --- |
    | -g GID | グループDを指定 |
    | -n 新グループ名 | グループ名を指定（新グループ名に変更） |

## 8.1.3 ユーザとグループの削除
### userdel
```bash
# ユーザを削除
userdel [オプション] ユーザ名
```
- 主なオプション
    | オプション | 説明 |
    | --- | --- |
    | -r (--remove) | ホームディレクトリも削除 |
    | -f (--force) | ログイン中のユーザを削除 |

### groupdel
- そのグループを利用しているユーザがいる場合は削除できない
```bash
# グループを削除
groupdel グループ名
```

## 8.1.4 ユーザとグループの設定ファイル
- /etc/passwd
    - ユーザ情報を保存
    - パーミッション：644
    - 指定してuser追加しなかった情報は、**/etc/default/useradd**や **/etc/login.defs**を参照される
    - なんらかの理由でpasswdをエディターで編集したい場合は「**vipw**」コマンドを利用
```bash
sysadms:x:1000:1000::/home/sysadms:/bin/bash

    sysadms         : ユーザ
    x               : パスワード現在は/etc/shadowで管理
    1000            : UID
    1000            : GID
    ::              : コメント
    /home/sysadms   : ホームディレクトリ
    /bin/bash       : ログインシェル
```
- /etc/shadow
    - パスワード情報を保存
    - パーミッション：000など
```bash
sysadms:$6$a~~~~~~~~:19307:0:99999:7:::

    sysadms         : ユーザ名
    $6$a~~          : ハッシュ化されたパスワード
    19307           : 最終変更日（1970/1/1からの通算日数）
    0               : 変更可能最短日数（0ならいつでも変更可能）
    99999           : いつまで同じパスワードを使い続けられるか
    7               : パスワード有効警告日
                    : 使用不可になるまでの日数(パスワードの有効期限後)
                    : アカウントの有効期限
                    : 将来的に使用できる用に予約フィールド
```
- /etc/group
    - グループ情報を保存
    - パーミッション：644
```bash
sysadms:x:1000:

    sysadms         : グループ
    x               : パスワード
    2000            : GID
                    : 所属メンバー(サブグループとして所属しているメンバー)
```
### getent
- 上記の3ファイルの内容を参照できる
```bash
getent データベース [エントリ]
```
- データベース
    | オプション | 説明 |
    | --- | --- |
    | passwd, shadow, group | それぞれのファイルの内容（第二引数にアカウント名指定が可能） |
    | hosts | hostsファイルの内容（第二引数にホスト名を指定して、名前解決） |


# 8.2 ジョブ管理
## 8.2.1 cronによるジョブスケジューリング
- ジョブのスケジュール管理
    - cron (anacron)    ：　定期的に繰り返すジョブを管理
    - at　　　　    　　：　一度だけ実行するジョブを管理
- cronジョブの操作
    ```bash
    crontab オプション

        -e      : cronジョブの追加
        -l      : cronジョブの表示
        -r      : cronジョブの削除(まとめて。一つを削除したいなら、-eで直接削除)
    ```
- crontabファイル
    ```bash
    31 10 * * * touch /root/crontest.txt

        31      :   分（0~59）
        10      :   時（0~23）
        *       :   日（1~31）
        *       :   月（1~12 / jan~dec）
        *       :   曜日（0~7 / sun~sat）
        touch ~ :   実行するコマンドを1行で指定(スクリプトで運用するのが通常)
    ```
    ```
    1-5         : 「-」で連続した値を指定
    1,15,30     : 「,」で複数の値を指定
    */2         : 「*/」で「～に一度」という値を指定
    ```
- cronジョブが記録されるファイル＆ディレクトリ
    - /var/spool/cron/ユーザ名　　（ユーザ用）
    - /etc/crontab      （システム用）
        - システムが参照するcronジョブ用のディレクトリ
            - /etc/cron.hourly/
            - /etc/cron.daily/
            - /etc/cron.weekly/
            - /etc/cron.monthly/
    - /etc/cron.d/ ディレクトリ　（システム用）

## 8.2.2 anacronによるジョブスケジューリング
- 設定ファイルは「/etc/anacron」（CentOS）
- 違い
    - cron
        - crondが常駐して実行
        - システム起動中、指定したタイミングでジョブを実行
            - 3時ちょうどにあるジョブを実行
    - anacron  
        - cron経由で実行(anacronは常駐しない)
        - システム起動中、適当なタイミングでジョブを実行
            - 起動後、1時間に1度、anacronが実行され、未実行だったジョブを実行
    - 日単位
    - 実行履歴を管理している
## 8.2.3 atによるジョブスケジューリング
- at
    - どこかのタイミングで1回だけ実行したいジョブ
    ```bash
    at [オプション] 時刻

        <オプション>
        -f ファイル         ： 指定したファイルの内容を実行
        -l                  : atジョブの一覧表示(=atq)
        -c ジョブ番号       : 指定したジョブの内容を表示
        -r ジョブ番号       : atジョブの削除(=atrm)

        <引数>
        23:30           : その日の23:30に実行
        4pm + 1 days    : 翌日の午後4時
        noon jul 31     : 7/31の正午に実行
    ```
- cronとatのアクセス管理
    - 1.　/etc/cron.allow、/etc/at.allow　＝＞　ファイル内に記述されたユーザのみ利用可能
    - 2.　/etc/cron.deny、 /etc/at.deny　＝＞　ファイル内に記述されていないユーザのみ利用可能
    - 3.　どちらのファイルもない    ＝＞　rootのみ利用可能

# 8.3 ローカライゼーションと国際化
## 8.3.1 　i18n
- ローカライゼーション 
    - あるソフトウェアを別な言語環境で利用できるように提供すること
    - 言語ごとにことなるソフトウェアパッケージを用意するのは非合理
    - 様々な言語環境で利用できるようにすることを**国際化(i18n)**という
## 8.3.2 ロケール
- ソフトウェアを利用する際にベースとなる情報のことをさす
    | 変数 | 意味 |
    | :---: | :---:| 
    | LANG | すべての項目に使用するロケール |
    | LC_ALL | すべての項目に使用するロケール |
    | LC_MESSAGES | メッセージに使用するロケール |
    | LC_TIME | 日時に使用するロケール |
    | LC_MONETARY | 通貨記号など |
```bash
locale [オプション]

    -a      : 設定できる値をすべて表示
```
```
C           : Cロケール(POSIX準拠のロケール、英語で表記)
en_US.utf8  : 英語、アメリカ、UTF-8
ja_JP.utf8  : 日本語、日本、UTF-8
```
```bash
#そのコマンドだけ異なるロケールにした
LANG=C man ls
```
## 8.3.3 文字コードの変換
```bash
iconv [オプション] [ファイル名]

    -f 文字コード   : 変換対象となる文字コードを指定（form）
    -t              : 返還後の文字コードを指定（to）
    -l              : 指定できる文字コードの一覧を表示
```
- 主な文字コード
    | 変数 | 意味 |
    | :---: | :---:| 
    | ASCII | アルファベットや数字などの1バイト文字を表現 |
    | Shift-JIS | 日本語用文字。Windowsなど |
    | EUC | 日本語用文字。古いUNIX環境など |
    | UTF-8 | 世界中の文字を表現するためのUnicodeの文字符号化形式。Linuxの標準 |






# その他
- batchコマンド